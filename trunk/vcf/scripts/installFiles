#!/usr/bin/bash

cd ../installers/win32

rm vcfSrcFiles.iss

echo preparing list of all files for distribution in installer...

SRC_DIRS="../../include ../../src ../../ImageFormats ../../build ../../xmake ../../thirdparty"

echo 1st find
find $SRC_DIRS -iname '*.h' -o -iname '*.hpp' -o -iname '*.c' \
-o -iname '*.dsw' -o -iname '*.dsp' -o -iname '*.bmp' \
-o -iname '*.rgs' -o -iname '*.rc' -o -iname '*.xml' \
-o -iname '*.idl' > srcfiles.out

echo 2nd find
find $SRC_DIRS -iname '*.def' -o -iname '*.vcfdir' -o -iname '*.vcp' \
-o -iname '*.ico' -o -iname '*.rc2' -o -iname '*.odl' -o -iname '*.inl' \
-o -iname '*.vff' -o -iname '*.inf' -o -iname '*.vcproj' > srcfiles1.out
			
echo 3nd find			
find $SRC_DIRS -iname '*.cpp' -o -iname '*.CPP' -o -iname '*.HPP' \
-o -iname *.cxx -o -iname '*.CXX' -o -iname '*.cur' \
-o -iname '*.CUR' > srcfiles2.out

echo 4th find
find ../../examples -iname '*.h' -o -iname '*.cpp' -o -iname '*.CPP' \
-o -iname '*.dsw' -o -iname '*.dsp' -o -iname '*.bmp' \
-o -iname '*.rgs' -o -iname '*.rc' -o -iname '*.idl' \
-o -iname '*.def' -o -iname '*.ico' -o -iname '*.rc2' \
-o -iname '*.odl' -o -iname '*.vff' -o -iname '*.html' -o -iname '*.xml' > examples.out




#combine the outoput into a master list
cat srcfiles.out srcfiles1.out srcfiles2.out> files.out

rm srcfiles.out srcfiles1.out srcfiles2.out


echo file list built, creating file listing for vcfSrcFiles.iss

numLines=`wc -l files.out`
echo $numLines

pwd
numLines=`sed "s?files.out??g" <<< $numLines`



echo installation will include $numLines source files


dirFront=...\\..\\

touch out

echo preparing to create installation file listing...

for file in `cat files.out`
do
	echo $file > tmp	
	
	dirname $file > tmp
	#convert from '/' to '\'	
	sed -e 's/\//\\/g' tmp > tmp.2
	destDir=`cat tmp.2`
	
	destDir=`sed "s?$dirFront\??g" tmp.2`
	
	echo $file > tmp
	#convert from '/' to '\'	
	sed -e 's/\//\\/g' tmp > tmp.2	
	srcFile=`cat tmp.2`		
	
	
	echo "Source: $srcFile; DestDir: {app}\\$destDir; Components: Src" | cat - out > out.tmp
	mv out.tmp out
done

for file in `cat examples.out`
do
	echo $file > tmp	
	
	dirname $file > tmp
	#convert from '/' to '\'	
	sed -e 's/\//\\/g' tmp > tmp.2
	destDir=`cat tmp.2`
	
	destDir=`sed "s?$dirFront\??g" tmp.2`
	
	echo $file > tmp
	#convert from '/' to '\'	
	sed -e 's/\//\\/g' tmp > tmp.2	
	srcFile=`cat tmp.2`		
	
	
	echo "Source: $srcFile; DestDir: {app}\\$destDir; Components: Tutorials" | cat - out > out.tmp
	mv out.tmp out
done

echo ";autogenerated source file listing" | cat - out > out.tmp
mv out.tmp out


cp out vcfSrcFiles.iss
rm tmp examples.out tmp.2 out files.out

unix2dos vcfSrcFiles.iss

echo installation file listing is complete, all files stored in vcfSrcFiles.iss

cd ../../scripts

